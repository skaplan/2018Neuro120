clear all

% Load DMR stimulus specrogram and spiking responses from one neuron
load dmr_experiment

% Plot spectrogram of stimulus
plot_spectrogram(stim_spectrogram, stim_time, stim_freq)

%% Generate STA
t_past = 125; % in ms
t_future = 125; % in ms
sampling_rate = mean(median(diff(stim_time)));
sta_time = (-t_past/1000):sampling_rate:(t_future/1000);
sta_freq = stim_freq;

nfreq = size(sta_freq)
ntimes = size(sta_time)

staprime = zeros(nfreq, ntimes)

nspikes = size(spikes)

for i = 1:nspikes
    for j = 1:nfreq
        for k = 1:times
            spiketime = spikes(i)
            t = sta_time(k)
            stim_times = stim_time(stim_time > t + spiketime & stim_time <= (t + sampling_rate + spiketime))
            
            freqrow = stim_spectrogram(j)
            filtered = freqrow(freqrow
            staprime(j,k) = 
        end
    end
end

% Plot results
figure(2)
plot_spectrogram(sta, sta_time, sta_freq);
xlabel('Time relative to spike (ms)')
colorbar